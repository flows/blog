{"requires":["glob@3.x.x","handlebars@latest","marked@latest"],"nodeDefinitions":{"./graphs/{ns}/{name}.fbp":{"rh":{"site":{"id":"7f601cfb-3da0-4817-a1ff-0c89c3725210","type":"flow","links":[{"id":"dcc90dae-daa6-4ad3-99ef-d730d083429d","source":{"id":"d2643185-90d8-4569-a724-dd55f187455f","port":"out"},"target":{"id":"d7ee4758-86ae-4f52-b122-1ca2208194c2","port":"dir","setting":{"persist":true}},"metadata":{"title":"EnsureDir out -> dir HtmlFile"}},{"id":"1a2525f0-b22c-4138-8cf7-dac4ba0ffd9b","source":{"id":"f30721a1-c84a-4829-bb77-d09ec9565a27","port":"match"},"target":{"id":"c620231b-f29c-4dd0-b958-0c31bf2589f2","port":"file"},"metadata":{"title":"Glob match -> file Markdown"}},{"id":"17e633c7-1c2a-433a-a212-c2153ddc862c","source":{"id":"f30721a1-c84a-4829-bb77-d09ec9565a27","port":"match"},"target":{"id":"a0f0d8b9-e422-482a-9711-f7f93060af29","port":"path"},"metadata":{"title":"Glob match -> path BaseName"}},{"id":"a675c03c-e402-465a-b589-dd30d27cd527","source":{"id":"a0f0d8b9-e422-482a-9711-f7f93060af29","port":"result"},"target":{"id":"d7ee4758-86ae-4f52-b122-1ca2208194c2","port":"name"},"metadata":{"title":"BaseName result -> name HtmlFile"}},{"id":"2c48a57d-3872-4831-a7d2-f19d336b53f5","source":{"id":"07eba278-8df4-46c0-a11d-f27e6ef0383d","port":":complete"},"target":{"id":"3268de78-1b01-4eab-b139-234c55c2c3dd","port":"in"},"metadata":{"title":"WriteFile :complete -> in WriteResults"}},{"id":"c854af50-9153-4906-ae7d-184ca9e1f475","source":{"id":"f30721a1-c84a-4829-bb77-d09ec9565a27","port":"xmatch"},"target":{"id":"3268de78-1b01-4eab-b139-234c55c2c3dd","port":"xin"},"metadata":{"title":"Glob xmatch -> xin WriteResults"}},{"id":"773e1f64-b4ba-45af-bbe9-45c70a7b8267","source":{"id":"d7ee4758-86ae-4f52-b122-1ca2208194c2","port":"file"},"target":{"id":"07eba278-8df4-46c0-a11d-f27e6ef0383d","port":"file"},"metadata":{"title":"HtmlFile file -> file WriteFile"}},{"id":"20a35e44-c415-4f03-ab79-df644a92e75b","source":{"id":"c620231b-f29c-4dd0-b958-0c31bf2589f2","port":"out"},"target":{"id":"9541f830-c3d9-488d-ba0f-327cc8d36d69","port":"in"},"metadata":{"title":"Markdown out -> in SiteTemplate"}},{"id":"91d389ec-da7e-48e3-9471-1a1e91024ac5","source":{"id":"9541f830-c3d9-488d-ba0f-327cc8d36d69","port":"out"},"target":{"id":"1d80e69a-eeee-4d84-9d5e-ec31d9a8fa4a","port":"in"},"metadata":{"title":"SiteTemplate out -> in LayoutTemplate"}},{"id":"9d5c7f26-eb88-46aa-a919-2b63a902ed4a","source":{"id":"1d80e69a-eeee-4d84-9d5e-ec31d9a8fa4a","port":"out"},"target":{"id":"07eba278-8df4-46c0-a11d-f27e6ef0383d","port":"in"},"metadata":{"title":"LayoutTemplate out -> in WriteFile"}}],"nodes":[{"id":"a0f0d8b9-e422-482a-9711-f7f93060af29","title":"BaseName","ns":"path","name":"basename","context":{"ext":".md"},"provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"},{"id":"f30721a1-c84a-4829-bb77-d09ec9565a27","title":"Glob","ns":"fs","name":"glob","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"},{"id":"d7ee4758-86ae-4f52-b122-1ca2208194c2","title":"HtmlFile","ns":"fs","name":"file","context":{"ext":".html"},"provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"},{"id":"697822b1-a9a0-4f1f-aab1-f1e9983931ec","title":"Log","ns":"console","name":"log","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"},{"id":"07eba278-8df4-46c0-a11d-f27e6ef0383d","title":"WriteFile","ns":"fs","name":"writeFile","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"},{"id":"1d80e69a-eeee-4d84-9d5e-ec31d9a8fa4a","title":"LayoutTemplate","ns":"common","name":"template","provider":"./graphs/rh/{ns}/{name}.fbp"},{"id":"9541f830-c3d9-488d-ba0f-327cc8d36d69","title":"SiteTemplate","ns":"common","name":"template","provider":"./graphs/rh/{ns}/{name}.fbp"},{"id":"c620231b-f29c-4dd0-b958-0c31bf2589f2","title":"Markdown","ns":"common","name":"markdown","provider":"./graphs/rh/{ns}/{name}.fbp"},{"id":"d2643185-90d8-4569-a724-dd55f187455f","title":"EnsureDir","ns":"common","name":"createDir","provider":"./graphs/rh/{ns}/{name}.fbp"},{"id":"3268de78-1b01-4eab-b139-234c55c2c3dd","title":"WriteResults","ns":"object","name":"group","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"}],"title":"App","ns":"rh","name":"site","description":"Generates HTML pages from markdown documents","providers":{"@":{"url":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"},"blog":{"path":"./graphs/rh/{ns}/{name}.fbp","name":"blog"}},"ports":{"input":{"pattern":{"nodeId":"f30721a1-c84a-4829-bb77-d09ec9565a27","title":"Pattern","name":"match"},"dir":{"nodeId":"d2643185-90d8-4569-a724-dd55f187455f","title":"Dir","name":"in"},"siteTemplate":{"nodeId":"9541f830-c3d9-488d-ba0f-327cc8d36d69","title":"SiteTemplate","name":"file","setting":{"persist":true}},"layoutTemplate":{"nodeId":"1d80e69a-eeee-4d84-9d5e-ec31d9a8fa4a","title":"LayoutTemplate","name":"file","setting":{"persist":true}}},"output":{}},"provider":"./graphs/{ns}/{name}.fbp"}}},"https://serve-chix.rhcloud.com/nodes/{ns}/{name}":{"console":{"log":{"_id":"52645993df5da0102500004e","name":"log","ns":"console","description":"Console log","async":true,"phrases":{"active":"Logging to console"},"ports":{"input":{"msg":{"type":"any","title":"Log message","description":"Logs a message to the console","async":true,"required":true}},"output":{"out":{"type":"any","title":"Log message"}}},"fn":"on.input.msg = function() {\n  console.log(data);\n  output( { out: data });\n}\n","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}","title":"Log"}},"fs":{"readFile":{"_id":"52645992df5da0102500003a","name":"readFile","ns":"fs","title":"ReadFile","description":"fs readFile","phrases":{"active":"Reading file {{input.file}} ({{input.options.encoding}}, {{input.options.flag}})"},"require":{"fs":"builtin"},"ports":{"input":{"file":{"title":"Filename","type":"string","required":true},"encoding":{"title":"Encoding","type":"string","default":"utf-8"},"flag":{"title":"Flag","type":"string","default":"r"}},"output":{"error":{"title":"Error","type":"object"},"out":{"title":"Out","type":"object"}}},"fn":"output = [fs, 'readFile', input.file, {\n  flag: input.flag,\n  encoding: input.encoding\n}];\n","env":"server","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"},"mkdir":{"_id":"52645992df5da01025000037","name":"mkdir","ns":"fs","description":"fs mkdir","async":true,"phrases":{"active":"Creating directory {{input.path}}"},"require":{"fs":"builtin"},"ports":{"input":{"path":{"title":"Path","type":"string","async":true},"mode":{"title":"Mode","type":"number","default":"0777"}},"output":{"path":{"title":"Path","type":"string"},"error":{"title":"Error","type":"Error"}}},"fn":"on.input.path = function() {\n\n  fs.mkdir(data, input.mode, function(err) {\n    if(err) {\n      output({error: err});\n    } else {\n      output({path: data});\n    }\n  });\n\n};\n","env":"server","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}","title":"MkDir"},"exists":{"_id":"52645992df5da0102500002c","name":"exists","ns":"fs","async":true,"description":"fs exists","phrases":{"active":"Checking whether file {{input.path}} exists"},"require":{"fs":"builtin"},"ports":{"input":{"path":{"type":"string","async":true}},"output":{"yes":{"title":"Exists","type":"string"},"no":{"title":"Absent","type":"string"}}},"fn":"on.input.path = function() {\n  fs.exists(data, function(yes) {\n    if(yes) {\n      output( { yes: data } );\n    } else {\n      output( { no: data } );\n    }\n  });\n};\n","env":"server","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}","title":"DirExists"}},"object":{"set":{"_id":"52ef3631cf8e1bab142d5399","name":"set","ns":"object","description":"Set a property on an object, or else create a new object and set the property","phrases":{"active":"Setting property {{input.key}}"},"ports":{"input":{"in":{"title":"Value","type":"any"},"key":{"title":"Key","type":"string"},"object":{"title":"Object","type":"object","default":null}},"output":{"out":{"title":"out","type":"object"}}},"fn":"var obj = input.object ? input.object : {};\nobj[input.key] = input. in ;\noutput.out = obj;\n","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}","title":"MainBody"}},"template":{"handlebars":{"_id":"52ea878d1905561c7aa3bdbc","name":"handlebars","ns":"template","description":"Handlebars Template engine","require":{"handlebars":"latest"},"phrases":{"active":"Compiling handlebars template"},"ports":{"input":{"body":{"type":"string","format":"html","title":"Template body","description":"The body of the handlebars template","required":true},"vars":{"type":"object","title":"Input variables","description":"the input variables for this template","required":true},"handlebars":{"type":"function","title":"Handlebars","default":null}},"output":{"out":{"title":"HTML","type":"string"}}},"fn":"var hb = input.handlebars || handlebars;\nvar tpl = hb.compile(input.body);\noutput = {\n  out: tpl(input.vars)\n}\n","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}","title":"HandleBars"},"markdown":{"_id":"52645993df5da0102500005d","name":"markdown","ns":"template","async":true,"description":"Markdown","phrases":{"active":"Creating markdown document"},"require":{"marked":"latest"},"ports":{"input":{"in":{"type":"string","title":"Body","format":"markdown","description":"The body of this markdown document","async":true}},"output":{"out":{"title":"HTML","type":"string"}}},"fn":"on.input.in = function() {\n  output( { out: marked(data) });\n};\n","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}","title":"Markdown"}},"utils":{"dummy":{"_id":"52ef363dcf8e1bab142d53bb","name":"dummy","ns":"utils","title":"Complete","description":"Takes an input and passes it to output.","phrases":{"active":"Dummy"},"ports":{"input":{"in":{"type":"any","title":"Input"}},"output":{"out":{"type":"any","title":"Output"}}},"fn":"output.out = input. in\n","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"}}},"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json":{"path":{"basename":{"name":"basename","ns":"path","description":"Path basename","require":{"path":"builtin"},"phrases":{"active":"Getting basename for {{input.path}} and extension {{input.ext}}"},"ports":{"input":{"path":{"title":"Path","type":"string"},"ext":{"title":"Extension","type":"string"}},"output":{"result":{"title":"Result","type":"string"}}},"fn":"output = {\n  result: path.basename(input.path, input.ext)\n}\n","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json","title":"BaseName"}},"fs":{"glob":{"name":"glob","ns":"fs","title":"Glob","description":"Match files using the patterns the shell uses, like stars and stuff.","require":{"glob":"3.x.x"},"expose":["chi"],"phrases":{"active":"Globbing with pattern: {{input.pattern}}"},"ports":{"input":{"match":{"type":"string","title":"Pattern","description":"Pattern to be matched","required":true}},"output":{"error":{"type":"event","title":"Error","description":"Emitted when an unexpected error is encountered, or whenever any fs error occurs if `options.strict` is set."},"matches":{"type":"array","title":"Matches","description":"Filenames found matching the pattern"},"end":{"type":"event","title":"End","description":"When the matching is finished, this is emitted with all the matches found. If the `nonull` option is set, and no match was found, then the `matches` list contains the original pattern. The matches are sorted, unless the `nosort` flag is set."},"match":{"type":"event","title":"Match","description":"Every time a match is found, this is emitted with the matched."},"xmatch":{"type":"event","title":"Xmatch","description":"Used for transmitting the groupID."},"abort":{"type":"event","title":"Abort","description":"When `abort()` is called, this event is raised."}}},"fn":"output = function (cb) {\n\n  var g = chi.group('xmatch', cb);\n\n  var mg = new glob.Glob(input.match, {}, function (err, matches) {\n\n    cb({\n      matches: matches\n    });\n\n    g.done();\n\n    done();\n\n  });\n\n  mg.on('match', function (match) {\n\n    cb({\n      match: match\n    }, g.item());\n\n  });\n\n  mg.on('error', function (err) {\n\n    cb({\n      error: err\n    });\n\n  });\n\n  mg.on('abort', function () {\n\n    cb({\n      abort: null\n    });\n\n  });\n\n}\n","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json"},"file":{"name":"file","ns":"fs","description":"Create a filename based on dir, name and optional extenstion","phrases":{"active":"Created filename {{input.dir}}/{{input.name}}{{input.ext}}"},"require":{"path":"builtin"},"ports":{"input":{"name":{"title":"Name","type":"string","required":true},"dir":{"title":"Directory","type":"string"},"ext":{"title":"Extension","type":"string"}},"output":{"file":{"title":"File","type":"string"}}},"env":"server","fn":"var file = input.ext ? input.name + input.ext : input.name;\noutput.file = input.dir ? path.normalize([input.dir, file].join(path.sep)) : file;\n","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json","title":"HtmlFile"},"writeFile":{"name":"writeFile","ns":"fs","description":"fs writeFile","phrases":{"active":"Writing file {{input.file}}"},"require":{"fs":"builtin"},"ports":{"input":{"file":{"type":"string"},"in":{"type":"string"},"encoding":{"title":"Encoding","type":"string","default":"utf-8"},"mode":{"title":"Mode","type":"number","default":438},"flag":{"title":"Flag","type":"string","default":"w"}},"output":{"error":{"title":"Error","type":"object"}}},"env":"server","fn":"output = [fs, 'writeFile', input.file, input.in, {\n  encoding: input.encoding,\n  mode: input.mode,\n  flag: input.flag\n}];\n","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json","title":"WriteFile"}},"console":{"log":{"name":"log","ns":"console","description":"Console log","async":true,"phrases":{"active":"Logging to console"},"ports":{"input":{"msg":{"type":"any","title":"Log message","description":"Logs a message to the console","async":true,"required":true}},"output":{"out":{"type":"any","title":"Log message"}}},"fn":"on.input.msg = function() {\n  console.log(data);\n  output( { out: data });\n}\n","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json","title":"Log"}},"object":{"group":{"name":"group","ns":"object","async":true,"description":"Groups input into an array","phrases":{"active":"Grouping object"},"expose":["chi"],"ports":{"input":{"in":{"title":"Object","type":"any"},"xin":{"title":"In Group","type":"any"}},"output":{"out":{"title":"out","group":"result","type":"any"},"xout":{"title":"Xout","type":"array"}}},"fn":"on.input. in = function () {\n  // x contains our keys\n  for (var gid in x) {\n\n    if(!state.hasOwnProperty(gid)) {\n      state[gid] = {\n        items: [],\n        total: null,\n        complete: false\n      };\n    }\n\n    state[gid].items.push(data);\n\n    if (state[gid].complete &&\n      state[gid].total === (state[gid].items.length)) {\n\n      var g = chi.group('xout', output);\n      output({\n        out: state[gid].items\n      }, g.item());\n\n      g.done();\n\n      delete state[gid];\n\n    }\n\n  }\n};\n\non.input.xin = function () {\n\n  if(!state.hasOwnProperty(data.gid)) {\n    state[data.gid] = {\n      items: [],\n      total: null,\n      complete: false\n    };\n  }\n\n  if (data.complete) {\n    state[data.gid].total = data.items.length;\n    state[data.gid].complete = true;\n\n    // ok sometimes at this point we already have everything...\n    // I wonder if the function stays in scope, i think not.\n    if (state[data.gid].complete &&\n      state[data.gid].total === (state[data.gid].items.length)) {\n\n      var g = chi.group('xout', output);\n      output({\n        out: state[data.gid].items\n      }, g.item());\n\n      g.done();\n\n      delete state[data.gid];\n\n    }\n  }\n};\n","provider":"https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json","title":"WriteResults"}}},"./graphs/rh/{ns}/{name}.fbp":{"common":{"template":{"id":"c3d88c43-44a2-4beb-a10a-c9fe4b6af14c","type":"flow","links":[{"id":"97107955-3335-4c9d-91b9-339c2ed78a1f","source":{"id":"b2fea89a-c253-4243-adf0-6f51b6c81930","port":"out"},"target":{"id":"2f10cf26-9d24-471c-910a-356b7817f281","port":"body","setting":{"persist":true}},"metadata":{"title":"Layout out -> body HandleBars"}},{"id":"919c5c57-55b4-459c-8362-1d3b1f291e5b","source":{"id":"f887a19c-f7e1-462d-b46f-2394f3a0ab6e","port":"out"},"target":{"id":"2f10cf26-9d24-471c-910a-356b7817f281","port":"vars"},"metadata":{"title":"MainBody out -> vars HandleBars"}}],"nodes":[{"id":"b2fea89a-c253-4243-adf0-6f51b6c81930","title":"Layout","ns":"fs","name":"readFile","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"},{"id":"f887a19c-f7e1-462d-b46f-2394f3a0ab6e","title":"MainBody","ns":"object","name":"set","context":{"key":"body"},"provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"},{"id":"2f10cf26-9d24-471c-910a-356b7817f281","title":"HandleBars","ns":"template","name":"handlebars","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"}],"title":"SiteTemplate","ns":"common","name":"template","description":"Read Template and Process with Handlebars","ports":{"input":{"file":{"nodeId":"b2fea89a-c253-4243-adf0-6f51b6c81930","title":"File","name":"file","setting":{"persist":true}},"in":{"nodeId":"f887a19c-f7e1-462d-b46f-2394f3a0ab6e","title":"In","name":"in"}},"output":{"out":{"nodeId":"2f10cf26-9d24-471c-910a-356b7817f281","title":"Out","name":"out"}}},"providers":{"@":{"url":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"}},"provider":"./graphs/rh/{ns}/{name}.fbp"},"markdown":{"id":"c9ac1154-195a-443d-a8ff-3a70139570d3","type":"flow","links":[{"id":"54e502ca-de4a-4435-a1d1-bae3d8ebb7bf","source":{"id":"24f7ae8c-3b1e-43f6-bfd4-83133f0bd782","port":"out"},"target":{"id":"cfab3f3f-f28b-49bc-a1d3-d5178af71bd6","port":"in"},"metadata":{"title":"ReadFile out -> in Markdown"}}],"nodes":[{"id":"24f7ae8c-3b1e-43f6-bfd4-83133f0bd782","title":"ReadFile","ns":"fs","name":"readFile","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"},{"id":"cfab3f3f-f28b-49bc-a1d3-d5178af71bd6","title":"Markdown","ns":"template","name":"markdown","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"}],"title":"Markdown","description":"Reads a markdown file and processes it","ns":"common","name":"markdown","ports":{"input":{"file":{"nodeId":"24f7ae8c-3b1e-43f6-bfd4-83133f0bd782","title":"File","name":"file"}},"output":{"out":{"nodeId":"cfab3f3f-f28b-49bc-a1d3-d5178af71bd6","title":"Out","name":"out"}}},"providers":{"@":{"url":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"}},"provider":"./graphs/rh/{ns}/{name}.fbp"},"createDir":{"id":"20673115-da7a-44e6-8173-687ce3fb5015","type":"flow","links":[{"id":"292413b0-9eee-4eb4-a2a6-f1ff045a7269","source":{"id":"885a58b2-3319-412c-a70f-f3750f0d11fd","port":"no"},"target":{"id":"82fadbd0-6b77-4b55-9c7a-7c499d8bf909","port":"path"},"metadata":{"title":"DirExists no -> path MkDir"}},{"id":"5df8d85c-cba6-45e4-94c1-9bf45ea2f3d9","source":{"id":"82fadbd0-6b77-4b55-9c7a-7c499d8bf909","port":"path"},"target":{"id":"49c35093-21de-42f0-aae9-62dfa92a9bca","port":"in"},"metadata":{"title":"MkDir path -> in Complete"}},{"id":"7f99332e-8c48-492f-8beb-397a58d4bcd1","source":{"id":"885a58b2-3319-412c-a70f-f3750f0d11fd","port":"yes"},"target":{"id":"49c35093-21de-42f0-aae9-62dfa92a9bca","port":"in"},"metadata":{"title":"DirExists yes -> in Complete"}}],"nodes":[{"id":"82fadbd0-6b77-4b55-9c7a-7c499d8bf909","title":"MkDir","ns":"fs","name":"mkdir","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"},{"id":"885a58b2-3319-412c-a70f-f3750f0d11fd","title":"DirExists","ns":"fs","name":"exists","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"},{"id":"49c35093-21de-42f0-aae9-62dfa92a9bca","title":"Complete","ns":"utils","name":"dummy","provider":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"}],"title":"EnsureDir","ns":"common","name":"createDir","ports":{"input":{"in":{"nodeId":"885a58b2-3319-412c-a70f-f3750f0d11fd","title":"In","name":"path"}},"output":{"out":{"nodeId":"49c35093-21de-42f0-aae9-62dfa92a9bca","title":"Out","name":"out"}}},"providers":{"@":{"url":"https://serve-chix.rhcloud.com/nodes/{ns}/{name}"}},"provider":"./graphs/rh/{ns}/{name}.fbp"}}}}}