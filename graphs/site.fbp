title:       Markdown HTML Generator
description: Generates HTML pages from markdown documents

provider https://raw.github.com/psichi/chix-platform/master/nodes/{ns}/{name}.json

BaseName(path/basename)
Body(object/set)
Exists(fs/exists)
Glob(fs/glob)
HasDir(conditional/true)
MkDir(fs/mkdir)
HtmlDir(data/string)
HtmlFile(fs/file)
ReadFile(fs/readFile)
Layout(fs/readFile)
Log(console/log)
Markdown(template/markdown)
HandleBars(template/handlebars)
WriteFile(fs/writeFile)
Move(fs/move), MoveInstagram(fs/move)

# store html dir name
'./site' -> in HtmlDir

# Removes the .md extension
'.md' -> @ext BaseName

# Create dir if doesn't exists
HtmlDir out -> path Exists exists -> in HasDir
HasDir  no  -> :start MkDir

# persist will prevent input timeout also, todo, test that..
HtmlDir out -> ^path MkDir

# Html file creation
HtmlDir out -> ^dir HtmlFile
'.html' -> @ext HtmlFile

# collect all markdown files
'./site.md/*.md' -> match Glob

# Create list of files stripped from the .md extension
Glob match -> file ReadFile out -> in Markdown
Glob match -> path BaseName result -> name HtmlFile

WriteFile :complete -> in WriteResults(object/group)
WriteResults out -> :start Remove
WriteResults out -> :start RemoveInsta
Glob xmatch -> xin WriteResults

HtmlFile file -> file WriteFile

'./template/site.hb'   -> file SiteFile(fs/readFile) out -> ^body SiteTemplate(template/handlebars)
'./template/layout.hb' -> file Layout out -> ^body HandleBars

# I just need something accepting an object and to set a property on it.
# defaulting to setting that property on an empty object, object/set
Markdown out  -> in Body
'body'          -> ^key  Body  # not sure if the persist works, I think it does.
 Body out     -> vars SiteTemplate

'body' -> ^key MainBody(object/set)
SiteTemplate out -> in MainBody
MainBody out     -> vars HandleBars

#Body out      -> vars HandleBars

HandleBars out -> in WriteFile # .. the write file of above

# Move index to correct possition
'./index.html'       ->   path Remove(fs/unlink) # can't overwrite somehow
Remove :complete   -> :start Move
'./site/index.html'  ->   from Move
'./index.html'       ->     to Move

'./index.html'          ->   path RemoveInsta(fs/unlink)
RemoveInsta :complete   -> :start MoveInstagram
'./site/instagram.html' ->   from MoveInstagram
'./instagram.html'      ->     to MoveInstagram
